# =============================================================================
# SigNoz Pre-configured Dashboards
# =============================================================================
# JSON configuration for SigNoz dashboards via API
# Apply after SigNoz is deployed
# =============================================================================

dashboards:
  # -------------------------------------------------------------------------
  # Dashboard 1: Service Overview
  # -------------------------------------------------------------------------
  - name: "FIAP Main Service - Overview"
    description: "General metrics for the main service"
    tags: ["fiap", "main-service", "overview"]
    panels:
      - title: "Request Rate (req/s)"
        type: "graph"
        query: "rate(http_requests_total{service='k8s-main-service'}[5m])"
        
      - title: "Error Rate (%)"
        type: "graph"
        query: "(sum(rate(http_requests_total{service='k8s-main-service',status=~'5..'}[5m])) / sum(rate(http_requests_total{service='k8s-main-service'}[5m]))) * 100"
        
      - title: "Request Duration (p95)"
        type: "graph"
        query: "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{service='k8s-main-service'}[5m]))"
        
      - title: "Active Pods"
        type: "stat"
        query: "count(kube_pod_info{namespace='ftc-app-staging',pod=~'main-service.*'})"

  # -------------------------------------------------------------------------
  # Dashboard 2: Service Orders Business Metrics
  # -------------------------------------------------------------------------
  - name: "FIAP - Service Orders Business"
    description: "Business metrics for service orders"
    tags: ["fiap", "service-orders", "business"]
    panels:
      - title: "Orders Created (last 24h)"
        type: "stat"
        query: "increase(service_order_created_total{service='k8s-main-service'}[24h])"
        
      - title: "Orders by Status"
        type: "pie"
        query: "sum by (status) (service_order_status_total{service='k8s-main-service'})"
        
      - title: "Average Time in Each Status"
        type: "bar"
        query: "avg by (status) (service_order_status_duration_seconds{service='k8s-main-service'})"
        
      - title: "Conversion Funnel"
        type: "graph"
        queries:
          - "sum(service_order_status_total{status='pending'})"
          - "sum(service_order_status_total{status='in_progress'})"
          - "sum(service_order_status_total{status='completed'})"

  # -------------------------------------------------------------------------
  # Dashboard 3: Infrastructure Health
  # -------------------------------------------------------------------------
  - name: "FIAP - Infrastructure"
    description: "Kubernetes and infrastructure metrics"
    tags: ["fiap", "infrastructure", "kubernetes"]
    panels:
      - title: "Pod CPU Usage (%)"
        type: "graph"
        query: "(sum(rate(container_cpu_usage_seconds_total{namespace='ftc-app-staging',pod=~'main-service.*'}[5m])) by (pod) / sum(container_spec_cpu_quota{namespace='ftc-app-staging',pod=~'main-service.*'}/container_spec_cpu_period{namespace='ftc-app-staging',pod=~'main-service.*'}) by (pod)) * 100"
        
      - title: "Pod Memory Usage (MB)"
        type: "graph"
        query: "sum(container_memory_usage_bytes{namespace='ftc-app-staging',pod=~'main-service.*'}) by (pod) / 1024 / 1024"
        
      - title: "HPA Replicas"
        type: "graph"
        queries:
          - "kube_horizontalpodautoscaler_status_current_replicas{horizontalpodautoscaler='main-service-hpa'}"
          - "kube_horizontalpodautoscaler_status_desired_replicas{horizontalpodautoscaler='main-service-hpa'}"
          
      - title: "Pod Restarts"
        type: "stat"
        query: "sum(kube_pod_container_status_restarts_total{namespace='ftc-app-staging',pod=~'main-service.*'})"
