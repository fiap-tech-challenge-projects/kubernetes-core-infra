# =============================================================================
# OpenTelemetry Collector Configuration
# =============================================================================
# Configuracao adicional para o OTel Collector do SigNoz
# Usado para customizar a coleta de traces, metrics e logs
# =============================================================================

apiVersion: v1
kind: ConfigMap
metadata:
  name: otel-collector-config
  namespace: signoz
  labels:
    app.kubernetes.io/part-of: signoz
    app.kubernetes.io/component: otel-collector
data:
  # Configuracao adicional pode ser montada como arquivo
  # O SigNoz Helm chart ja configura o collector, este e para customizacoes

  # Exemplo de configuracao para filtrar spans
  filter-config.yaml: |
    # Filtros customizados podem ser adicionados aqui
    # Exemplo: filtrar health checks
    processors:
      filter/healthcheck:
        traces:
          span:
            - 'attributes["http.target"] == "/health"'
            - 'attributes["http.target"] == "/ready"'
            - 'attributes["http.target"] == "/live"'

---
# ServiceMonitor para Prometheus (se usar)
apiVersion: v1
kind: Service
metadata:
  name: otel-collector-metrics
  namespace: signoz
  labels:
    app.kubernetes.io/part-of: signoz
    app.kubernetes.io/component: otel-collector
spec:
  selector:
    app.kubernetes.io/name: signoz
    app.kubernetes.io/component: otel-collector
  ports:
    - name: metrics
      port: 8888
      targetPort: 8888
      protocol: TCP
